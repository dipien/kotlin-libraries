version = "2.1.0"

ext.JDROID_GITHUB_REPOSITORY_NAME = "jdroid-java"

// https://github.com/maxirosson/jdroid-gradle-plugin/blob/master/CHANGELOG.md
ext.JDROID_GRADLE_PLUGIN_VERSION = "2.0.0-SNAPSHOT"

apply plugin: "com.jdroid.root"
apply plugin: "com.jdroid.component.builder"

buildscript {
	repositories {
		jcenter {
			mavenContent {
				releasesOnly()
			}
		}
		maven { url = "https://plugins.gradle.org/m2/" }
		String localMavenRepoEnabled = project.hasProperty('LOCAL_MAVEN_REPO_ENABLED') ? project.ext.get('LOCAL_MAVEN_REPO_ENABLED') : System.getenv('LOCAL_MAVEN_REPO_ENABLED')
		boolean isLocalMavenRepoEnabled = localMavenRepoEnabled != null && localMavenRepoEnabled == "true"
		if (isLocalMavenRepoEnabled) {
			String localMavenRepo = project.hasProperty('LOCAL_MAVEN_REPO') ? project.ext.get('LOCAL_MAVEN_REPO') : System.getenv('LOCAL_MAVEN_REPO')
			if (localMavenRepo != null) {
				maven {
					url = localMavenRepo
					content {
						includeGroup("com.jdroidtools")
					}
				}
			}
		}
		maven {
			url = "https://oss.sonatype.org/content/repositories/snapshots/"
			content {
				includeGroup("com.jdroidtools")
			}
			mavenContent {
				snapshotsOnly()
			}
		}
	}
	dependencies {
		// https://github.com/maxirosson/jdroid-component-builder/blob/master/CHANGELOG.md
		classpath("com.jdroidtools:jdroid-component-builder:2.0.0-SNAPSHOT")

		// https://github.com/maxirosson/jdroid-gradle-plugin/blob/master/CHANGELOG.md
		classpath("com.jdroidtools:jdroid-gradle-root-plugin:2.0.0-SNAPSHOT")
	}
}

subprojects {

	buildscript {
		repositories {
			jcenter {
				mavenContent {
					releasesOnly()
				}
			}
			String localMavenRepoEnabled = project.hasProperty('LOCAL_MAVEN_REPO_ENABLED') ? project.ext.get('LOCAL_MAVEN_REPO_ENABLED') : System.getenv('LOCAL_MAVEN_REPO_ENABLED')
			boolean isLocalMavenRepoEnabled = localMavenRepoEnabled != null && localMavenRepoEnabled == "true"
			if (isLocalMavenRepoEnabled) {
				String localMavenRepo = project.hasProperty('LOCAL_MAVEN_REPO') ? project.ext.get('LOCAL_MAVEN_REPO') : System.getenv('LOCAL_MAVEN_REPO')
				if (localMavenRepo != null) {
					maven {
						url = localMavenRepo
						content {
							includeGroup("com.jdroidtools")
						}
					}
				}
			}
			maven {
				url = "https://oss.sonatype.org/content/repositories/snapshots/"
				content {
					includeGroup("com.jdroidtools")
				}
				mavenContent {
					snapshotsOnly()
				}
			}
		}
	}

	repositories {
		jcenter {
			mavenContent {
				releasesOnly()
			}
		}
		String localMavenRepo = project.hasProperty("LOCAL_MAVEN_REPO") ? project.ext.get("LOCAL_MAVEN_REPO") : System.getenv("LOCAL_MAVEN_REPO")
		if (localMavenRepo != null) {
			maven {
				url = localMavenRepo
				content {
					includeGroup("com.jdroidtools")
				}
			}
		}
		maven {
			url = "https://oss.sonatype.org/content/repositories/snapshots/"
			content {
				includeGroup("com.jdroidtools")
			}
			mavenContent {
				snapshotsOnly()
			}
		}
	}
}
